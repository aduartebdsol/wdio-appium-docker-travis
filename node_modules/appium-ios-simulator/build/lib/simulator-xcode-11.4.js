"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _simulatorXcode = _interopRequireDefault(require("./simulator-xcode-11"));

const NATIVE_SIMCTL_PERMISSIONS = ['all', 'calendar', 'contacts-limited', 'contacts', 'location', 'location-always', 'photos-add', 'photos', 'media-library', 'microphone', 'motion', 'reminders', 'siri'];

class SimulatorXcode11_4 extends _simulatorXcode.default {
  constructor(udid, xcodeVersion) {
    super(udid, xcodeVersion);
    this._locationMenu = 'Features';
  }

  async setAppearance(value) {
    await this.simctl.setAppearance(_lodash.default.toLower(value));
  }

  async getAppearance() {
    return await this.simctl.getAppearance();
  }

  async addCertificate(payload, opts = {}) {
    const {
      isRoot = true
    } = opts;
    const methodName = isRoot ? 'addRootCertificate' : 'addCertificate';
    await this.simctl[methodName](payload, {
      raw: true
    });
    return true;
  }

  async pushNotification(payload) {
    await this.simctl.pushNotification(payload);
  }

  async setPermissions(bundleId, permissionsMapping) {
    _logger.default.debug(`Setting access for '${bundleId}': ` + JSON.stringify(permissionsMapping, null, 2));

    const nonNativePerms = {};

    for (let [permName, access] of _lodash.default.toPairs(permissionsMapping)) {
      if (!NATIVE_SIMCTL_PERMISSIONS.includes(permName)) {
        nonNativePerms[permName] = access;
        continue;
      }

      access = _lodash.default.toLower(access);

      if (permName === 'medialibrary') {
        permName = 'media-library';
      } else if (permName === 'location' && access === 'always') {
        permName = 'location-always';
      }

      switch (access) {
        case 'yes':
        case 'inuse':
        case 'always':
          await this.simctl.grantPermission(bundleId, permName);
          break;

        case 'no':
        case 'never':
          await this.simctl.revokePermission(bundleId, permName);
          break;

        case 'unset':
          await this.simctl.resetPermission(bundleId, permName);
          break;

        default:
          throw new Error(`Unknown access value: ${access}`);
      }
    }

    if (!_lodash.default.isEmpty(nonNativePerms)) {
      _logger.default.info(`The following permissions have not been recognized as native: ` + JSON.stringify(permissionsMapping, null, 2));

      await super.setPermissions(bundleId, nonNativePerms);
    }
  }

  async clearKeychains() {
    await this.simctl.resetKeychain();
  }

}

var _default = SimulatorXcode11_4;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW11bGF0b3IteGNvZGUtMTEuNC5qcyJdLCJuYW1lcyI6WyJOQVRJVkVfU0lNQ1RMX1BFUk1JU1NJT05TIiwiU2ltdWxhdG9yWGNvZGUxMV80IiwiU2ltdWxhdG9yWGNvZGUxMSIsImNvbnN0cnVjdG9yIiwidWRpZCIsInhjb2RlVmVyc2lvbiIsIl9sb2NhdGlvbk1lbnUiLCJzZXRBcHBlYXJhbmNlIiwidmFsdWUiLCJzaW1jdGwiLCJfIiwidG9Mb3dlciIsImdldEFwcGVhcmFuY2UiLCJhZGRDZXJ0aWZpY2F0ZSIsInBheWxvYWQiLCJvcHRzIiwiaXNSb290IiwibWV0aG9kTmFtZSIsInJhdyIsInB1c2hOb3RpZmljYXRpb24iLCJzZXRQZXJtaXNzaW9ucyIsImJ1bmRsZUlkIiwicGVybWlzc2lvbnNNYXBwaW5nIiwibG9nIiwiZGVidWciLCJKU09OIiwic3RyaW5naWZ5Iiwibm9uTmF0aXZlUGVybXMiLCJwZXJtTmFtZSIsImFjY2VzcyIsInRvUGFpcnMiLCJpbmNsdWRlcyIsImdyYW50UGVybWlzc2lvbiIsInJldm9rZVBlcm1pc3Npb24iLCJyZXNldFBlcm1pc3Npb24iLCJFcnJvciIsImlzRW1wdHkiLCJpbmZvIiwiY2xlYXJLZXljaGFpbnMiLCJyZXNldEtleWNoYWluIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUdBLE1BQU1BLHlCQUF5QixHQUFHLENBQ2hDLEtBRGdDLEVBRWhDLFVBRmdDLEVBR2hDLGtCQUhnQyxFQUloQyxVQUpnQyxFQUtoQyxVQUxnQyxFQU1oQyxpQkFOZ0MsRUFPaEMsWUFQZ0MsRUFRaEMsUUFSZ0MsRUFTaEMsZUFUZ0MsRUFVaEMsWUFWZ0MsRUFXaEMsUUFYZ0MsRUFZaEMsV0FaZ0MsRUFhaEMsTUFiZ0MsQ0FBbEM7O0FBaUJBLE1BQU1DLGtCQUFOLFNBQWlDQyx1QkFBakMsQ0FBa0Q7QUFDaERDLEVBQUFBLFdBQVcsQ0FBRUMsSUFBRixFQUFRQyxZQUFSLEVBQXNCO0FBQy9C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QU47QUFDRDtBQUNGOztBQUtELFFBQU1XLGNBQU4sR0FBd0I7QUFDdEIsVUFBTSxLQUFLN0IsTUFBTCxDQUFZOEIsYUFBWixFQUFOO0FBQ0Q7O0FBN0orQzs7ZUFnS25DdEMsa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgU2ltdWxhdG9yWGNvZGUxMSBmcm9tICcuL3NpbXVsYXRvci14Y29kZS0xMSc7XG5cblxuY29uc3QgTkFUSVZFX1NJTUNUTF9QRVJNSVNTSU9OUyA9IFtcbiAgJ2FsbCcsXG4gICdjYWxlbmRhcicsXG4gICdjb250YWN0cy1saW1pdGVkJyxcbiAgJ2NvbnRhY3RzJyxcbiAgJ2xvY2F0aW9uJyxcbiAgJ2xvY2F0aW9uLWFsd2F5cycsXG4gICdwaG90b3MtYWRkJyxcbiAgJ3Bob3RvcycsXG4gICdtZWRpYS1saWJyYXJ5JyxcbiAgJ21pY3JvcGhvbmUnLFxuICAnbW90aW9uJyxcbiAgJ3JlbWluZGVycycsXG4gICdzaXJpJyxcbl07XG5cblxuY2xhc3MgU2ltdWxhdG9yWGNvZGUxMV80IGV4dGVuZHMgU2ltdWxhdG9yWGNvZGUxMSB7XG4gIGNvbnN0cnVjdG9yICh1ZGlkLCB4Y29kZVZlcnNpb24pIHtcbiAgICBzdXBlcih1ZGlkLCB4Y29kZVZlcnNpb24pO1xuXG4gICAgLy8gZm9yIHNldHRpbmcgdGhlIGxvY2F0aW9uIHVzaW5nIEFwcGxlU2NyaXB0LCB0aGUgdG9wLWxldmVsIG1lbnUgdGhyb3VnaCB3aGljaFxuICAgIC8vIHRoZSAnTG9jYXRpb24nIG9wdGlvbiBpcyBmb3VuZFxuICAgIHRoaXMuX2xvY2F0aW9uTWVudSA9ICdGZWF0dXJlcyc7XG4gIH1cblxuICAvKipcbiAgICogQG92ZXJyaWRlXG4gICAqIFNldHMgVUkgYXBwZWFyYW5jZSBzdHlsZS5cbiAgICogVGhpcyBmdW5jdGlvbiBjYW4gb25seSBiZSBjYWxsZWQgb24gYSBib290ZWQgc2ltdWxhdG9yLlxuICAgKlxuICAgKiBAc2luY2UgWGNvZGUgU0RLIDExLjRcbiAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIG9uZSBvZiBwb3NzaWJsZSBhcHBlYXJhbmNlIHZhbHVlczpcbiAgICogLSBkYXJrOiB0byBzd2l0Y2ggdG8gdGhlIERhcmsgbW9kZVxuICAgKiAtIGxpZ2h0OiB0byBzd2l0Y2ggdG8gdGhlIExpZ2h0IG1vZGVcbiAgICovXG4gIGFzeW5jIHNldEFwcGVhcmFuY2UgKHZhbHVlKSB7XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwuc2V0QXBwZWFyYW5jZShfLnRvTG93ZXIodmFsdWUpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3ZlcnJpZGVcbiAgICogR2V0cyB0aGUgY3VycmVudCBVSSBhcHBlYXJhbmNlIHN0eWxlXG4gICAqIFRoaXMgZnVuY3Rpb24gY2FuIG9ubHkgYmUgY2FsbGVkIG9uIGEgYm9vdGVkIHNpbXVsYXRvci5cbiAgICpcbiAgICogQHNpbmNlIFhjb2RlIFNESyAxMS40XG4gICAqIEByZXR1cm5zIHtzdHJpbmd9IHRoZSBjdXJyZW50IFVJIGFwcGVhcmFuY2Ugc3R5bGUuXG4gICAqIFBvc3NpYmxlIHZhbHVlcyBhcmU6XG4gICAqIC0gZGFyazogdG8gc3dpdGNoIHRvIHRoZSBEYXJrIG1vZGVcbiAgICogLSBsaWdodDogdG8gc3dpdGNoIHRvIHRoZSBMaWdodCBtb2RlXG4gICAqL1xuICBhc3luYyBnZXRBcHBlYXJhbmNlICgpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5zaW1jdGwuZ2V0QXBwZWFyYW5jZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIHtPYmplY3R9IENlcnRpZmljYXRlT3B0aW9uc1xuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IGlzUm9vdCBbdHJ1ZV0gLSBXaGV0aGVyIHRvIGluc3RhbGwgdGhlIGdpdmVuXG4gICAqIGNlcnRpZmljYXRlIGludG8gdGhlIFRydXN0ZWQgUm9vdCBzdG9yZSAoYHRydWVgKSBvciB0byB0aGUga2V5Y2hhaW5cbiAgICogKGBmYWxzZWApXG4gICAqL1xuXG4gIC8qKlxuICAgKiBAb3ZlcnJpZGVcbiAgICogQWRkcyB0aGUgZ2l2ZW4gY2VydGlmaWNhdGUgdG8gdGhlIGJvb3RlZCBzaW11bGF0b3IuXG4gICAqIFRoZSBzaW11bGF0b3IgY291bGQgYmUgaW4gYm90aCBydW5uaW5nIGFuZCBzaHV0ZG93biBzdGF0ZXNcbiAgICogaW4gb3JkZXIgZm9yIHRoaXMgbWV0aG9kIHRvIHJ1biBhcyBleHBlY3RlZC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBheWxvYWQgdGhlIGNvbnRlbnQgb2YgdGhlIFBFTSBjZXJ0aWZpY2F0ZVxuICAgKiBAcGFyYW0ge0NlcnRpZmljYXRlT3B0aW9uc30gb3B0c1xuICAgKi9cbiAgYXN5bmMgYWRkQ2VydGlmaWNhdGUgKHBheWxvYWQsIG9wdHMgPSB7fSkge1xuICAgIGNvbnN0IHtcbiAgICAgIGlzUm9vdCA9IHRydWUsXG4gICAgfSA9IG9wdHM7XG4gICAgY29uc3QgbWV0aG9kTmFtZSA9IGlzUm9vdCA/ICdhZGRSb290Q2VydGlmaWNhdGUnIDogJ2FkZENlcnRpZmljYXRlJztcbiAgICBhd2FpdCB0aGlzLnNpbWN0bFttZXRob2ROYW1lXShwYXlsb2FkLCB7cmF3OiB0cnVlfSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogQG92ZXJyaWRlXG4gICAqIFNpbXVsYXRlcyBwdXNoIG5vdGlmaWNhdGlvbiBkZWxpdmVyeSB0byB0aGUgYm9vdGVkIHNpbXVsYXRvclxuICAgKlxuICAgKiBAc2luY2UgWGNvZGUgU0RLIDExLjRcbiAgICogQHBhcmFtIHtPYmplY3R9IHBheWxvYWQgLSBUaGUgb2JqZWN0IHRoYXQgZGVzY3JpYmVzIEFwcGxlIHB1c2ggbm90aWZpY2F0aW9uIGNvbnRlbnQuXG4gICAqIEl0IG11c3QgY29udGFpbiBhIHRvcC1sZXZlbCBcIlNpbXVsYXRvciBUYXJnZXQgQnVuZGxlXCIga2V5IHdpdGggYSBzdHJpbmcgdmFsdWUgbWF0Y2hpbmdcbiAgICogdGhlIHRhcmdldCBhcHBsaWNhdGlvbuKAmHMgYnVuZGxlIGlkZW50aWZpZXIgYW5kIFwiYXBzXCIga2V5IHdpdGggdmFsaWQgQXBwbGUgUHVzaCBOb3RpZmljYXRpb24gdmFsdWVzLlxuICAgKiBGb3IgZXhhbXBsZTpcbiAgICoge1xuICAgKiAgIFwiU2ltdWxhdG9yIFRhcmdldCBCdW5kbGVcIjogXCJjb20uYXBwbGUuUHJlZmVyZW5jZXNcIixcbiAgICogICBcImFwc1wiOiB7XG4gICAqICAgICBcImFsZXJ0XCI6IFwiVGhpcyBpcyBhIHNpbXVsYXRlZCBub3RpZmljYXRpb24hXCIsXG4gICAqICAgICBcImJhZGdlXCI6IDMsXG4gICAqICAgICBcInNvdW5kXCI6IFwiZGVmYXVsdFwiXG4gICAqICAgfVxuICAgKiB9XG4gICAqL1xuICBhc3luYyBwdXNoTm90aWZpY2F0aW9uIChwYXlsb2FkKSB7XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwucHVzaE5vdGlmaWNhdGlvbihwYXlsb2FkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3ZlcnJpZGVcbiAgICogU2V0cyB0aGUgcGVybWlzc2lvbnMgZm9yIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIGJ1bmRsZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQXBwbGljYXRpb24gYnVuZGxlIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwZXJtaXNzaW9uc01hcHBpbmcgLSBBIG1hcHBpbmcgd2hlcmUga2F5c1xuICAgKiBhcmUgc2VydmljZSBuYW1lcyBhbmQgdmFsdWVzIGFyZSB0aGVpciBjb3JyZXNwb25kaW5nIHN0YXR1cyB2YWx1ZXMuXG4gICAqIFRoZSBmb2xsb3dpbmcga2V5cyBhcmUgc3VwcG9ydGVkOlxuICAgKiAtIGFsbDogQXBwbHkgdGhlIGFjdGlvbiB0byBhbGwgc2VydmljZXMuXG4gICAqIC0gY2FsZW5kYXI6IEFsbG93IGFjY2VzcyB0byBjYWxlbmRhci5cbiAgICogLSBjb250YWN0cy1saW1pdGVkOiBBbGxvdyBhY2Nlc3MgdG8gYmFzaWMgY29udGFjdCBpbmZvLlxuICAgKiAtIGNvbnRhY3RzOiBBbGxvdyBhY2Nlc3MgdG8gZnVsbCBjb250YWN0IGRldGFpbHMuXG4gICAqIC0gbG9jYXRpb246IEFsbG93IGFjY2VzcyB0byBsb2NhdGlvbiBzZXJ2aWNlcyB3aGVuIGFwcCBpcyBpbiB1c2UuXG4gICAqIC0gbG9jYXRpb24tYWx3YXlzOiBBbGxvdyBhY2Nlc3MgdG8gbG9jYXRpb24gc2VydmljZXMgYXQgYWxsIHRpbWVzLlxuICAgKiAtIHBob3Rvcy1hZGQ6IEFsbG93IGFkZGluZyBwaG90b3MgdG8gdGhlIHBob3RvIGxpYnJhcnkuXG4gICAqIC0gcGhvdG9zOiBBbGxvdyBmdWxsIGFjY2VzcyB0byB0aGUgcGhvdG8gbGlicmFyeS5cbiAgICogLSBtZWRpYS1saWJyYXJ5OiBBbGxvdyBhY2Nlc3MgdG8gdGhlIG1lZGlhIGxpYnJhcnkuXG4gICAqIC0gbWljcm9waG9uZTogQWxsb3cgYWNjZXNzIHRvIGF1ZGlvIGlucHV0LlxuICAgKiAtIG1vdGlvbjogQWxsb3cgYWNjZXNzIHRvIG1vdGlvbiBhbmQgZml0bmVzcyBkYXRhLlxuICAgKiAtIHJlbWluZGVyczogQWxsb3cgYWNjZXNzIHRvIHJlbWluZGVycy5cbiAgICogLSBzaXJpOiBBbGxvdyB1c2Ugb2YgdGhlIGFwcCB3aXRoIFNpcmkuXG4gICAqIFRoZSBmb2xsb3dpbmcgdmFsdWVzIGFyZSBzdXBwb3J0ZWQ6XG4gICAqIC0geWVzOiBUbyBncmFudCB0aGUgcGVybWlzc2lvblxuICAgKiAtIG5vOiBUbyByZXZva2UgdGhlIHBlcm1pc3Npb25cbiAgICogLSB1bnNldDogVG8gcmVzZXQgdGhlIHBlcm1pc3Npb25cbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBjaGFuZ2luZyBwZXJtaXNzaW9ucy5cbiAgICovXG4gIGFzeW5jIHNldFBlcm1pc3Npb25zIChidW5kbGVJZCwgcGVybWlzc2lvbnNNYXBwaW5nKSB7XG4gICAgbG9nLmRlYnVnKGBTZXR0aW5nIGFjY2VzcyBmb3IgJyR7YnVuZGxlSWR9JzogYCArXG4gICAgICBKU09OLnN0cmluZ2lmeShwZXJtaXNzaW9uc01hcHBpbmcsIG51bGwsIDIpKTtcbiAgICBjb25zdCBub25OYXRpdmVQZXJtcyA9IHt9O1xuICAgIGZvciAobGV0IFtwZXJtTmFtZSwgYWNjZXNzXSBvZiBfLnRvUGFpcnMocGVybWlzc2lvbnNNYXBwaW5nKSkge1xuICAgICAgaWYgKCFOQVRJVkVfU0lNQ1RMX1BFUk1JU1NJT05TLmluY2x1ZGVzKHBlcm1OYW1lKSkge1xuICAgICAgICBub25OYXRpdmVQZXJtc1twZXJtTmFtZV0gPSBhY2Nlc3M7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBhY2Nlc3MgPSBfLnRvTG93ZXIoYWNjZXNzKTtcbiAgICAgIGlmIChwZXJtTmFtZSA9PT0gJ21lZGlhbGlicmFyeScpIHtcbiAgICAgICAgcGVybU5hbWUgPSAnbWVkaWEtbGlicmFyeSc7XG4gICAgICB9IGVsc2UgaWYgKHBlcm1OYW1lID09PSAnbG9jYXRpb24nICYmIGFjY2VzcyA9PT0gJ2Fsd2F5cycpIHtcbiAgICAgICAgcGVybU5hbWUgPSAnbG9jYXRpb24tYWx3YXlzJztcbiAgICAgIH1cbiAgICAgIHN3aXRjaCAoYWNjZXNzKSB7XG4gICAgICAgIGNhc2UgJ3llcyc6XG4gICAgICAgIGNhc2UgJ2ludXNlJzpcbiAgICAgICAgY2FzZSAnYWx3YXlzJzpcbiAgICAgICAgICBhd2FpdCB0aGlzLnNpbWN0bC5ncmFudFBlcm1pc3Npb24oYnVuZGxlSWQsIHBlcm1OYW1lKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbm8nOlxuICAgICAgICBjYXNlICduZXZlcic6XG4gICAgICAgICAgYXdhaXQgdGhpcy5zaW1jdGwucmV2b2tlUGVybWlzc2lvbihidW5kbGVJZCwgcGVybU5hbWUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICd1bnNldCc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5zaW1jdGwucmVzZXRQZXJtaXNzaW9uKGJ1bmRsZUlkLCBwZXJtTmFtZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGFjY2VzcyB2YWx1ZTogJHthY2Nlc3N9YCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghXy5pc0VtcHR5KG5vbk5hdGl2ZVBlcm1zKSkge1xuICAgICAgbG9nLmluZm8oYFRoZSBmb2xsb3dpbmcgcGVybWlzc2lvbnMgaGF2ZSBub3QgYmVlbiByZWNvZ25pemVkIGFzIG5hdGl2ZTogYCArXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KHBlcm1pc3Npb25zTWFwcGluZywgbnVsbCwgMikpO1xuICAgICAgYXdhaXQgc3VwZXIuc2V0UGVybWlzc2lvbnMoYnVuZGxlSWQsIG5vbk5hdGl2ZVBlcm1zKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQG92ZXJyaWRlXG4gICAqL1xuICBhc3luYyBjbGVhcktleWNoYWlucyAoKSB7XG4gICAgYXdhaXQgdGhpcy5zaW1jdGwucmVzZXRLZXljaGFpbigpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNpbXVsYXRvclhjb2RlMTFfNDtcbiJdLCJmaWxlIjoibGliL3NpbXVsYXRvci14Y29kZS0xMS40LmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
